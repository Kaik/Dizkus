<!--[*  $Id: pnforum_user_viewtopic.html,v 1.97 2006/04/14 17:45:18 landseer Exp $  *]-->

<!--[ setforumtitle title=$topic.topic_title ]-->

<!--[ include file='pnforum_user_header.html' ]-->

<!--[ pnmodcallhooks hookobject=item hookaction=display hookid=$topic.topic_id implode=false ]-->

<div class="optionrow pnf_bgcolor3 pnf_bordercolor2">
    <div>
        <!--[ if $topic.topic_id neq $topic.prev_topic_id ]-->
        <a class="image previoustopiclink" title="<!--[ pnml name='_PNFORUM_PREVIOUS_TOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=viewtopic topic=$topic.prev_topic_id ]-->"></a>
        <!--[ /if ]-->
        
        <!--[ if $topic.access_comment ]-->
            <a class="image newtopiclink" title="<!--[ pnml name='_PNFORUM_NEWTOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=newtopic forum=$topic.forum_id ]-->"><!--[ pnml name='_PNFORUM_NEWTOPIC' ]--></a>
        <!--[ /if ]-->
        
        <!--[ if $pncore.logged_in ]-->
            <a class="image mailtolink" title="<!--[ pnml name='_PNFORUM_EMAIL_TOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=emailtopic topic=$topic.topic_id ]-->"><!--[ pnml name='_PNFORUM_EMAIL_TOPIC' ]--></a>
        <!--[ /if ]-->
        
        <!--[ printtopic_button topic_id=$topic.topic_id cat_id=$topic.cat_id forum_id=$topic.forum_id ]-->
        
        <!--[ if $pncore.logged_in ]-->
        <a id="subscribetopicbutton" class="image subscribetopiclink" style="display: none;" onclick="javascript:subscribeunsubscribetopic(<!--[ $topic.topic_id ]-->,'subscribe');" href="javascript:void(0);" title="<!--[ pnml name="_PNFORUM_SUBSCRIBE_TOPIC" ]-->"><!--[ pnml name='_PNFORUM_SUBSCRIBE_TOPIC' ]--></a>
        <a id="unsubscribetopicbutton" class="image unsubscribetopiclink" style="display: none;" onclick="javascript:subscribeunsubscribetopic(<!--[ $topic.topic_id ]-->,'unsubscribe');" href="javascript:void(0);" title="<!--[ pnml name="_PNFORUM_UNSUBSCRIBE_TOPIC" ]-->"><!--[ pnml name='_PNFORUM_UNSUBSCRIBE_TOPIC' ]--></a>
        <noscript>
            <!--[ if $topic.is_subscribed == 0 ]-->
                <a class="image subscribetopiclink" href="<!--[ pnmodurl modname="pnForum" type="user" func="prefs" act="subscribe_topic" topic=$topic.topic_id ]-->" title="<!--[ pnml name="_PNFORUM_SUBSCRIBE_TOPIC" ]-->"><!--[ pnml name='_PNFORUM_SUBSCRIBE_TOPIC' ]--></a>
            <!--[ else ]-->
                <a class="image unsubscribetopiclink" href="<!--[ pnmodurl modname="pnForum" type="user" func="prefs" act="unsubscribe_topic" topic=$topic.topic_id ]-->" title="<!--[ pnml name="_PNFORUM_SUBSCRIBE_TOPIC" ]-->"><!--[ pnml name='_PNFORUM_SUBSCRIBE_TOPIC' ]--></a>
            <!--[ /if ]-->
        </noscript>
        <!--[ /if ]-->
        <!--[ if $topic.topic_id neq $topic.next_topic_id ]-->
        <a class="image nexttopiclink" title="<!--[ pnml name='_PNFORUM_NEXT_TOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=viewtopic topic=$topic.next_topic_id ]-->"></a>
        <!--[ /if ]-->
    </div>

    <!--[ if $topic.access_moderate eq 1 ]-->
    <div style="margin: 0.5em 0 0.5em 0;">
        <a style="display: none;" id="locktopicbutton" class="image locktopiclink" title="<!--[ pnml name='_PNFORUM_LOCKTOPIC' ]-->" href="javascript:void(0);" onclick="javascript:lockunlocktopic(<!--[ $topic.topic_id ]-->, 'lock');"><!--[ pnml name='_PNFORUM_LOCKTOPIC' ]--></a>
        <a style="display: none;" id="unlocktopicbutton" class="image unlocktopiclink" title="<!--[ pnml name='_PNFORUM_UNLOCKTOPIC' ]-->" href="javascript:void(0);" onclick="javascript:lockunlocktopic(<!--[ $topic.topic_id ]-->, 'unlock');"><!--[ pnml name='_PNFORUM_UNLOCKTOPIC' ]--></a>
        <noscript>
            <!--[ if $topic.topic_status eq 0 ]-->
                <a class="image locktopiclink" title="<!--[ pnml name='_PNFORUM_LOCKTOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=topicadmin mode=lock topic=$topic.topic_id ]-->"><!--[ pnml name="_PNFORUM_LOCKTOPIC" ]--></a>
            <!--[ else ]-->
                <a class="image unlocktopiclink" title="<!--[ pnml name='_PNFORUM_UNLOCKTOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=topicadmin mode=unlock topic=$topic.topic_id ]-->"><!--[ pnml name="_PNFORUM_UNLOCKTOPIC" ]--></a>
            <!--[ /if ]-->
        </noscript>
    
        <a class="image stickytopiclink" style="display: none;" id="stickytopicbutton" title="<!--[ pnml name='_PNFORUM_STICKYTOPIC' ]-->"   href="javascript:void(0);" onclick="javascript:stickyunstickytopic(<!--[ $topic.topic_id ]-->, 'sticky')"><!--[ pnml name='_PNFORUM_STICKYTOPIC' ]--></a>
        <a class="image unstickytopiclink" style="display: none;" id="unstickytopicbutton" title="<!--[ pnml name='_PNFORUM_UNSTICKYTOPIC' ]-->" href="javascript:void(0);" onclick="javascript:stickyunstickytopic(<!--[ $topic.topic_id ]-->, 'unsticky')"><!--[ pnml name='_PNFORUM_UNSTICKYTOPIC' ]--></a>
        <noscript>
            <!--[ if $topic.sticky eq 0 ]-->
                <a class="image stickytopiclink" title="<!--[ pnml name='_PNFORUM_STICKYTOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=topicadmin mode=sticky topic=$topic.topic_id ]-->"><!--[ pnml name='_PNFORUM_STICKYTOPIC' ]--></a>
            <!--[ else ]-->
                <a class="image unstickytopiclink" title="<!--[ pnml name='_PNFORUM_UNSTICKYTOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=topicadmin mode=unsticky topic=$topic.topic_id ]-->"><!--[ pnml name='_PNFORUM_UNSTICKYTOPIC' ]--></a>
            <!--[ /if ]-->
        </noscript>
        <a class="image movetopiclink" title="<!--[ pnml name='_PNFORUM_MOVETOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=topicadmin mode=move topic=$topic.topic_id ]-->"><!--[ pnml name='_PNFORUM_MOVETOPIC' ]--></a>
        <a class="image deletetopiclink" title="<!--[ pnml name='_PNFORUM_DELETETOPIC' ]-->" href="<!--[ pnmodurl modname=pnForum type=user func=topicadmin mode=delete topic=$topic.topic_id ]-->"><!--[ pnml name='_PNFORUM_DELETETOPIC' ]--></a>
    </div>
    <!--[ /if ]-->



</div>
<!--[* start of breadcrumbs *]-->
<p>
<a href="<!--[ pnmodurl modname=pnForum type=user func=main ]-->"><strong><!--[ pnml name='_PNFORUM_START' ]--></strong></a><strong><!--[ pnml name='_PNFORUM_SEPARATOR' html=1 ]--></strong>
<a href="<!--[ pnmodurl modname=pnForum type=user func=main viewcat=$topic.cat_id ]-->"><strong><!--[ $topic.cat_title|pnvarprepfordisplay ]--></strong></a><strong><!--[ pnml name='_PNFORUM_SEPARATOR' html=1 ]--></strong>
<a href="<!--[ pnmodurl modname=pnForum type=user func=viewforum forum=$topic.forum_id]-->"><strong><!--[ $topic.forum_name|pnvarprepfordisplay ]--></strong></a><strong><!--[ pnml name='_PNFORUM_SEPARATOR' html=1 ]-->
<!--[ $topic.topic_title|pnvarprepfordisplay|pnvarcensor ]--></strong><br />
</p>
<!--[* end of breadcrumbs *]-->
<p>
<!--[ pnml name='_PNFORUM_MODERATEDBY' ]-->:
<!--[ listforummods moderators=$topic.forum_mods ]-->
</p>
<!--[ topicpager total=$topic.total_posts start=$topic.post_start topic_id=$topic.topic_id ]-->

<div class="topicheader pnf_bordercolor2 pnf_bgcolor3 pnf_clearfix">
    <div class="topicheaderleft">
        <a id="top" title="<!--[ pnml name='_PNFORUM_BOTTOM' ]-->" href="#bottom"><!--[ pnimg src="icon_bottom.gif" alt="_PNFORUM_BOTTOM" altml=true ]--></a>
    </div>
    <div class="topicheaderright pnf_clearfix" id="topicsubject_<!--[ $topic.topic_id ]-->" <!--[ if $topic.access_topicsubjectedit eq 1 ]-->title="<!--[ pnml name='_PNFORUM_CLICKTOEDIT' ]-->" onclick="javascript:topicsubjectedit(<!--[ $topic.topic_id ]-->)"<!--[ /if ]-->>
        <span id="topicsubject_<!--[ $topic.topic_id ]-->_content"><!--[ $topic.topic_title|pnvarprepfordisplay|pnvarcensor ]--></span>
    </div>
</div>
<br />
<div style="float: left; text-align: left;" class="pnf_clearfix">
    <ul style="padding: 0; margin: 0;">
        <!--[ counter start=0 print=false assign=post_counter]-->
        <!--[ foreach key=num item=post from=$topic.posts ]-->
        <!--[ counter ]-->
        <li style="padding: 0; margin: 0; text-align: left;">
            <!--[ include file="pnforum_user_singlepost.html" ]-->
        </li>
        <!--[ /foreach ]-->
        <li id="quickreplyposting" style="padding: 0; margin: 0; display: none;">
            
        </li>
    </ul>
    
    <!--[ pnupper_fileuploads objectid=$topic.topic_id ]-->
</div>
<!--[ topicpager total=$topic.total_posts start=$topic.post_start topic_id=$topic.topic_id ]-->

<!--[* **** unused, this is  performance hog, use it on your own risk, but don't blame me 
<!--[ similartopics search=$topic.topic_title ]-->
<!--[ if $similartopics|@count > 0]-->
<ul id="similartopics" class="pnf_clearfix">
    <li style="line-height: 1.5em; font-size: 1.2em; font-weight: bold;">
        <!--[ pnml name='_PNFORUM_SIMILARTOPICS' ]-->:
    </li>
    <!--[ foreach item=similartopic from=$similartopics ]-->
    <!--[ if $topic.topic_id neq $similartopic.topic_id ]-->
    <li>
        <a href="<!--[ pnmodurl modname=pnForum type=user func=viewtopic topic=$similartopic.topic_id ]-->" title="<!--[ pnml name='_PNFORUM_GOTO_TOPIC' ]--> '<!--[ $similartopic.topic_title ]-->'"><!--[ $similartopic.topic_title ]--></a>
    </li>
    <!--[ /if ]-->
    <!--[ /foreach ]-->
</ul>
<!--[ /if ]-->
end of unused code **** *]-->

<!--[ if ($topic.topic_status neq 1) and ($topic.access_comment eq true) ]-->
<div id="quickreply" class="pnf_clearfix">        
    <form name="quickreplyform" id="quickreplyform" action="<!--[ pnmodurl modname=pnForum type=user func=reply ]-->" method="post" enctype="multipart/form-data">
    <input type="hidden" id="forum" name="forum" value="<!--[ $topic.forum_id ]-->" />
    <input type="hidden" id="topic" name="topic" value="<!--[ $topic.topic_id ]-->" />
    <input type="hidden" id="quote" name="quote" value="" />
    <input type="hidden" id="authid" name="authid" value="<!--[ pnsecgenauthkey module=pnForum ]-->" />
    <fieldset class="pnf_bordercolor2 pnf_bgcolor3" >
        <legend><!--[ pnml name='_PNFORUM_QUICKREPLY' ]--></legend>
        <div style="margin: 1em;">
        <div id="quickreplypreview" style="display: none;">&nbsp;</div>
        <div id="pnforuminformation">&nbsp;</div>
        <div id="quickreplyeditor" class="pnf_clearfix">
            <textarea class="pnf_textarea" id="message" name="message" style="width:99%; height: 10em;" ></textarea>
            <!--[ if $pncore.pnForum.striptags == 'yes' ]-->
                <div><!--[ pnml name='_PNFORUM_NOHTMLALLOWED' ]--></div>
            <!--[ /if ]-->
        </div>
        <div class="pnf_clearfix">
            <div id="quickreplyoptions">
                <ul>
                    <li>
                        <strong><!--[ pnml name='_PNFORUM_OPTIONS' ]--></strong>
                    </li>
                    <!--[ if $pncore.logged_in ]-->
                    <li>
                        <input type="checkbox" id="attach_signature" name="attach_signature" checked="checked" value="1" />
                        <label for="attach_signature"><!--[ pnml name='_PNFORUM_ATTACHSIGNATURE' ]--></label>
                    </li>
                    <li>
                        <input type="checkbox" id="subscribe_topic" name="subscribe_topic" <!--[ if $topic.is_subscribed eq true ]-->checked="checked"<!--[ /if ]--> value="1" />
                        <label for="subscribe_topic"><!--[ pnml name='_PNFORUM_NOTIFYME' ]--></label>
                    </li>
                    <!--[ /if ]-->
                    <li id="quickreplybuttons" style="margin: 1.5em; display: none; text-align: left;">
                        <button onclick="createQuickReply(); return false;" type="submit" title="<!--[ pnml name='_PNFORUM_SUBMIT' ]-->">
                        <!--[ pnimg src="icon_ok.gif" alt="_PNFORUM_SUBMIT" altml=true class="postingbutton" ]--><!--[ pnml name='_PNFORUM_SUBMIT' ]-->
                        </button>
                        <button onclick="previewQuickReply(); return false;" type="submit" title="<!--[ pnml name='_PNFORUM_PREVIEW' ]-->">
                        <!--[ pnimg src="icon_preview.gif" alt="_PNFORUM_PREVIEW" altml=true class="postingbutton" ]--><!--[ pnml name='_PNFORUM_PREVIEW' ]-->
                        </button>
                        <button onclick="clearQuickReply();" type="reset" title="<!--[ pnml name='_PNFORUM_CANCELPOST' ]-->">
                        <!--[ pnimg src="icon_cancel.gif" alt="_PNFORUM_CANCELPOST" altml=true class="postingbutton" ]--><!--[ pnml name="_PNFORUM_CANCEL" ]-->
                        </button>
                    </li>
                    
                    <li id="nonajaxquickreplybuttons" style="text-align: left; margin: 1.5em;">
                        <button name="submit" type="submit" value="submit" title="<!--[ pnml name='_PNFORUM_SUBMIT' ]-->">
                        <!--[ pnimg src="icon_ok.gif" alt="_PNFORUM_SUBMIT" altml=true class="postingbutton" ]--><!--[ pnml name='_PNFORUM_SUBMIT' ]-->
                        </button>
                        <button name="preview" type="submit" value="1" title="<!--[ pnml name='_PNFORUM_PREVIEW' ]-->">
                        <!--[ pnimg src="icon_preview.gif" alt="_PNFORUM_PREVIEW" altml=true class="postingbutton" ]--><!--[ pnml name='_PNFORUM_PREVIEW' ]-->
                        </button>
                        <button name="reset" type="button" value="reset" title="<!--[ pnml name='_PNFORUM_CANCELPOST' ]-->" onclick="self.location.href='<!--[ pnmodurl modname=pnForum type=user func=viewtopic topic=$topic.topic_id ]-->'">
                        <!--[ pnimg src="icon_cancel.gif" alt="_PNFORUM_CANCELPOST" altml=true class="postingbutton" ]--><!--[ pnml name="_PNFORUM_CANCEL" ]-->
                        </button>
                    </li>
            
                </ul>
            
            </div>
            <div id="quickreplyhooks" style="float: left; margin-top: 1em;">
                <!--[ plainbbcode textfieldid=message ]-->
                <!--[ bbsmile textfieldid=message ]-->
                <!--[* $hooks.pnUpper *]--><br />
            </div>
        </div>
        </div>
    </fieldset>

    </form>

</div>
<!--[ /if ]-->
<div style="text-align:center;">
<!--[ $hooks.Ratings ]-->
</div>

<script type="text/javascript">
    var storingReply = '<!--[ pnml name='_PNFORUM_STORINGREPLY' ]-->';
    var preparingPreview = '<!--[ pnml name='_PNFORUM_PREPARINGPREVIEW' ]-->';
    var storingPost = '<!--[ pnml name='_PNFORUM_STORINGPOST' ]-->';
    var deletingPost = '<!--[ pnml name='_PNFORUM_DELETINGPOST' ]-->';
    var updatingPost = '<!--[ pnml name='_PNFORUM_UPDATINGPOST' ]-->';
    var statusNotChanged = '<!--[ pnml name='_PNFORUM_STATUS_NOTCHANGED' ]-->';
    var statusChanged = '<!--[ pnml name='_PNFORUM_STATUS_CHANGED' ]-->';

    <!--[ if $topic.access_moderate eq true ]-->
    var topic_sticky = <!--[ $topic.sticky ]-->;
    if(topic_sticky == 0) {
        Element.show('stickytopicbutton');
    } else {
        Element.show('unstickytopicbutton');
    }

    var topic_status = <!--[ $topic.topic_status ]-->;
    if(topic_status == 0) {
        Element.show('locktopicbutton');
    } else {
        Element.show('unlocktopicbutton');
    }
    <!--[ /if ]-->
    
    if($('subscribetopicbutton') && $('unsubscribetopicbutton')) {
        var is_subscribed = <!--[ $topic.is_subscribed ]-->;
        if(is_subscribed == 0) {
            Element.show('subscribetopicbutton');
        } else {
            Element.show('unsubscribetopicbutton');
        }
    }
    
    
    if($('quickreply')) {
        Resizable.initialize("message");
        Element.show($('quickreplybuttons'));
        Element.hide($('nonajaxquickreplybuttons'));
        $('quickreplyform').action = '';
    }
</script>

<!--[ include file='pnforum_user_footer.html' ]-->
